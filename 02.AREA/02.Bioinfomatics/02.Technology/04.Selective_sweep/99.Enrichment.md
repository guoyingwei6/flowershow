---
created: 2024-11-20 18:03
updated: 2025-06-10 09:54
dg-publish: true
tags:
  - garden/ğŸŒ±Seedling
---



## å¯Œé›†åˆ†ææ°”æ³¡å›¾å¯è§†åŒ–

```python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

# åŠ è½½æ•°æ®
data = pd.read_csv('enrichment.chart.txt', delimiter='\t')

# ç¡®ä¿PValueä¸ä¸º0ï¼Œä»¥ä¾¿å–å¯¹æ•°
data['PValue'] = data['PValue'].replace(0, np.nan)
data.dropna(subset=['PValue'], inplace=True)

# å¯¹PValueå–è´Ÿå¯¹æ•°ï¼Œä»¥ä¾¿æ›´å¥½åœ°åœ¨å›¾ä¸Šè¡¨ç¤º
data['-log10(PValue)'] = -np.log10(data['PValue'])

# è¿‡æ»¤æ‰åŸºå› æ•°ç›®å°äº5çš„é¡¹ï¼Œä¸”åªä¿ç•™GO termç›¸å…³çš„æ¡ç›®
data = data[(data['Count'] >= 5) & data['Term'].str.contains("GO:")]

# å°†Termä¸­â€œ~â€ä¹‹åçš„å†…å®¹ä½œä¸ºæ–°çš„Term
data['Term'] = data['Term'].apply(lambda x: x.split('~')[-1])

# æŒ‰PValueæ’åº
data.sort_values('PValue', inplace=True)

# è®¾ç½®å›¾çš„å¤§å°
plt.figure(figsize=(24, 6))

# ç»˜åˆ¶æ°”æ³¡å›¾ï¼Œäº¤æ¢xå’Œyè½´çš„æ•°æ®
scatter = plt.scatter(data['Term'], data['Fold Enrichment'], 
                      s=data['Count']*30,  # æ°”æ³¡å¤§å°ï¼ŒCountå­—æ®µå†³å®šï¼Œå¯ä»¥æŒ‰éœ€è°ƒæ•´ç³»æ•°
                      c=data['-log10(PValue)'],  # é¢œè‰²ç”±PValueå†³å®š
                      cmap='viridis', alpha=1, edgecolors='w', linewidth=0.5)

# æ·»åŠ è‰²æ ‡
plt.colorbar(scatter, label='-log10(PValue)')

# æ·»åŠ æ ‡é¢˜å’Œè½´æ ‡ç­¾
#plt.xlabel('GO Terms')
plt.ylabel('Fold Enrichment')
#plt.title('Gene Set Enrichment Analysis (GSEA) Bubble Plot')

# åˆ›å»ºç”¨äºå›¾ä¾‹çš„å‡æ ‡ç­¾
for count in [5, 10, 15, 20]:  # ç¤ºä¾‹åŸºå› æ•°ç›®ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´
    plt.scatter([], [], s=count*10, c='black', alpha=1, label=str(count))

# æ·»åŠ å›¾ä¾‹ï¼Œè¯´æ˜åŸºå› æ•°ç›®
plt.legend(scatterpoints=1, frameon=False, labelspacing=1, title='Gene Count', bbox_to_anchor=(1.05, 1))

# æ—‹è½¬xè½´æ ‡ç­¾90åº¦
plt.xticks(rotation=45)

# å±•ç¤ºå›¾å½¢
plt.savefig('enrich.pdf')
```